# Check for quadratic convergence of difference between GF and all-atom
# This is the all-atom run script
# Learned the spring constants and nearest neighbor distances from
# /scratch0/gpumaster/tsharp/mar2013lammps/examples/ljlearn_3n/repeat
# vljfull
# Recall: type 2 is special in pair_eam for eam gf method.  so dont use type 2 eam here

log log.full
shell "rm log.lammps"

units		metal
boundary        p p f
processors      1 2 1
atom_style	atomic
newton          off

read_data       8fulldatafileht10

pair_style eam/alloy
pair_coeff   * * Au-Grochola-JCP05.eam.alloy Au Au Au Au Au
pair_modify	shift yes

# Optional neighbor command
neighbor        4.0 bin
neigh_modify    every 1 delay 0 check yes
group           gfmdgroup type 5
group           type4 type 4
group           type14 type 1 4

# Create a probe of atoms to displace
region          columnregion1 block 0.5 4.6 0.5 4.6 INF INF units box
region          columnregion2 block 12.6 14.7 12.4 14.7 INF INF units box
group           col1group region columnregion1
group           col2group region columnregion2
group           columns union col1group col2group
#group           probe intersect columns type4
#group		could have created a way to select the 4 planes that correspond to all gfmd atoms in the gfmd file
group           probe type 4 # matches the top 2 planes of the gfmd layer in the above input file
#group		probe type 3 # matches the planes above gfmd layer in the file gfmd corresponding to the input file above
group		probe1 intersect col1group type4
group		probe2 intersect col2group type4
#group		probe union probe1 probe2

fix             bottomfix gfmdgroup setforce 0.0 0.0 0.0

thermo		50

# Optional dump_image command
#dump 3 all image 10 aimag.full.*.jpg fz type adiam 0.8 size 1024 1024 view 90.0 0.0 center s 0.5 0.5 0.5 zoom 2 shiny 1 axes yes 0.8 0.02 
#dump_modify 3 backcolor white amap -0.01 0.01 ca 0 6 min red -1e-6 black -9e-7 gray 9e-7 gray 1e-6 blue max aqua
#dump_modify 3 pad 4


# initialize (before pushing) allowing to equilibriate before holding any atoms rigid
min_style cg
min_modify dmax 0.3 line quadratic
minimize 0.0 1.0e-9 1000 1000

run 1 # can help with minimization
minimize 0.0 1.0e-9 1000 1000

# Store the initial probe atom locations
# dump  initprobedump all custom 1 dumpinitallgf x y z fx fy fz
# run 0 
# undump initprobedump

# Make rigid after surface relaxes
fix             2      probe setforce 0.0 0.0 0.0
fix_modify      2      energy no
fix             fixID1 probe aveforce 0.0 0.0 0.0
fix_modify      fixID1 energy no



#variable n loop 0 3
#label nloop
# Several loops to encourage minimize to hit force tolerance, or multiple displace steps
#if "$n < 3" then "variable mydstep equal 0.0" else "variable mydstep equal ${dstep}"


displace_atoms probe1 move ${dstep} 0 ${dstep} units box
displace_atoms probe2 move 0 ${dstep} 0        units box

min_modify dmax 0.3 line quadratic
minimize 0.0 1.0e-9 100000 100000
run 1
minimize 0.0 1.0e-9 100000 100000


# # Dump all atoms for posterity
# dump            dumpid all custom 1 dump.ljgf x y z fx fy fz
# run 0
# undump          dumpid

#next n
#jump SELF nloop

#run 100

unfix 2
unfix fixID1
dump           probedump probe custom 1 dumpprobefull x y z fx fy fz
run 0 


